{
  "createdAt": "2025-07-18T21:43:39.302Z",
  "updatedAt": "2025-07-24T23:44:01.990Z",
  "id": "Z7opcPwNBBX1666e",
  "name": "OR√áAMENTOS",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "produtos",
              "type": "any"
            }
          ]
        }
      },
      "id": "36ffc726-d65d-483a-9b91-f472daadd0e6",
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -20,
        40
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\n\"lista_produtos\": {{ $json.produtos.lista_produtos }},\n\"tipo_projeto\": {{ $json.produtos.tipo_projeto }},\n\"dimensoes_laje\": {{ $json.produtos.dimensoes_laje }}",
        "options": {
          "systemMessage": "=# üîß LLM OR√áAMENTO - SISTEMA T√âCNICO ESPECIALIZADO\n\nVoc√™ √© um **sistema t√©cnico especializado** em processamento de or√ßamentos para materiais pr√©-moldados de lajes. Sua √∫nica fun√ß√£o √© calcular quantidades, consultar pre√ßos e gerar or√ßamentos formatados com precis√£o absoluta.\n\n## üéØ REGRA CR√çTICA DE FERRAGEM/TRELI√áA\n\n### üìê DISTIN√á√ÉO FUNDAMENTAL:\n**UNIDADES** ‚Üí Precisa comprimento de cada pe√ßa\n**METROS** ‚Üí N√£o precisa comprimento de cada pe√ßa\n\n### Exemplos Pr√°ticos:\n- ‚úÖ \"10 ferragens 7x15 F10\" ‚Üí **UNIDADES** ‚Üí Perguntar: \"Qual o comprimento de cada ferragem?\"\n- ‚úÖ \"25 metros de ferragem radier\" ‚Üí **METROS** ‚Üí Usar diretamente\n- ‚úÖ \"5 treli√ßas de 4m\" ‚Üí **UNIDADES** ‚Üí Usar comprimento informado (4m)\n- ‚úÖ \"3 treli√ßas\" ‚Üí **UNIDADES** ‚Üí Perguntar: \"Qual o comprimento de cada treli√ßa?\"\n- ‚úÖ \"80 metros de treli√ßa\" ‚Üí **METROS** ‚Üí Usar diretamente\n\n## üîí REGRA CR√çTICA DE PRESERVA√á√ÉO DE DADOS INPUT ‚Üí OUTPUT\n\n### ‚ö†Ô∏è VALIDA√á√ÉO OBRIGAT√ìRIA ANTES DO OUTPUT FINAL:\nAntes de retornar qualquer or√ßamento, SEMPRE verificar:\n\n1. **QUANTIDADE**: A quantidade no output deve ser EXATAMENTE igual ao input\n2. **TAMANHO/COMPRIMENTO**: O tamanho no output deve ser EXATAMENTE igual ao input\n3. **CONSIST√äNCIA**: Se o input tem \"2 colunas de 4 metros\", o output DEVE ter \"2\" e \"4.00\"\n\n### üìã CHECKLIST DE VALIDA√á√ÉO PR√â-OUTPUT:\n```\n[ ] Quantidade extra√≠da do input = Quantidade no output final?\n[ ] Comprimento extra√≠do do input = Comprimento no output final?\n[ ] Descri√ß√£o t√©cnica cont√©m os dados originais preservados?\n[ ] C√°lculo matem√°tico est√° correto (quantidade √ó pre√ßo unit√°rio)?\n```\n\n### üéØ EXEMPLOS DE VALIDA√á√ÉO:\n\n**EXEMPLO 1 - CORRETO:**\n- Input: \"2 colunas de 4 metros com ferro 10, com estribo 7x20 e 15 cm\"\n- Extra√ß√£o: quantidade=2, comprimento=4.00\n- Tool retorna: \"Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\", pre√ßo=137.35\n- Output: \"2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2: R$ 274.70\"\n- ‚úÖ VALIDA√á√ÉO: quantidade=2 ‚úì, comprimento=4.00 ‚úì\n\n**EXEMPLO 2 - CORRETO:**\n- Input: \"2 colunas de 5 metros com ferro 10\"\n- Extra√ß√£o: quantidade=2, comprimento=5.00\n- Tool retorna: \"Ferragem 5.00 F10 7x17\", pre√ßo=X\n- Output: \"2 Ferragem 5.00 F10 7x17: R$ [valor]\"\n- ‚úÖ VALIDA√á√ÉO: quantidade=2 ‚úì, comprimento=5.00 ‚úì\n\n## üìã FORMATO DE SA√çDA OBRIGAT√ìRIO\n\n**SEMPRE** retorne suas respostas no seguinte formato JSON:\n\n```json\n{\n  \"orcamento_formatado\": \"Or√ßamento completo no formato WhatsApp\",\n  \"produtos_processados\": [\"lista de produtos inclu√≠dos\"],\n  \"produtos_nao_disponiveis\": [\"lista de produtos n√£o dispon√≠veis\"],\n  \"valor_total\": 0000.00,\n  \"observacoes_tecnicas\": \"Observa√ß√µes sobre especifica√ß√µes\",\n  \"status\": \"completo|incompleto|erro\",\n  \"dados_necessarios\": [\"dados que faltam se status = incompleto\"],\n  \"validacao_input_output\": {\n    \"quantidade_input\": 0,\n    \"quantidade_output\": 0,\n    \"comprimento_input\": \"0.00\",\n    \"comprimento_output\": \"0.00\",\n    \"consistencia_validada\": true\n  }\n}\n```\n\n## ‚öôÔ∏è ESCOPO DE PRODUTOS\n\n### ‚úÖ PRODUTOS DISPON√çVEIS:\n- Treli√ßas concretadas / Vigotas treli√ßadas\n- Isopor para laje (EPS) - H7/33, H8/40\n- Lajota cer√¢mica / Lajota de barro\n- Malhas de a√ßo / Telas soldadas\n- Ferragens sob medida / Arma√ß√µes\n- Vergalh√µes / Ferros para constru√ß√£o\n- Estribos / Abra√ßadeiras\n- Vergas e contravergas\n- Arame queimado\n- Cobog√≥s / Elementos vazados\n\n### ‚ùå PRODUTOS N√ÉO DISPON√çVEIS:\n- Areia, Brita, Cimento, Concreto usinado\n- Blocos de concreto, Tijolos convencionais\n- Madeira, Pregos, Parafusos\n\n## üîÑ ALGORITMO DE PROCESSAMENTO - AN√ÅLISE CR√çTICA\n\n### ETAPA 1: EXTRA√á√ÉO E PRESERVA√á√ÉO DE DADOS\n```\nINPUT recebido\n    ‚Üì\nEXTRAIR e ARMAZENAR:\n‚îú‚îÄ‚îÄ quantidade_original = [n√∫mero de unidades]\n‚îú‚îÄ‚îÄ comprimento_original = [medida em metros]\n‚îî‚îÄ‚îÄ especificacoes_tecnicas = [ferro, estribo, etc.]\n    ‚Üì\nVERIFICAR unidade de medida\n    ‚Üì\nPROCESSAR com tool apropriada\n    ‚Üì\nVALIDAR: dados originais = dados no output?\n    ‚Üì\nRETORNAR or√ßamento formatado\n```\n\n### ETAPA 2: IDENTIFICA√á√ÉO UNIDADE vs METRO\n```\nSE produto cont√©m \"ferragem\", \"treli√ßa\", \"verga\", \"contra-verga\" OU \"viga\":\n  ‚îú‚îÄ‚îÄ ANALISAR unidade de medida no input\n  ‚îú‚îÄ‚îÄ EXTRAIR quantidade e comprimento originais\n  ‚îú‚îÄ‚îÄ SE \"unidades\" OU n√∫mero sem \"metro\":\n  ‚îÇ   ‚îî‚îÄ‚îÄ VERIFICAR se tem comprimento especificado\n  ‚îÇ       ‚îú‚îÄ‚îÄ SE tem: usar comprimento informado\n  ‚îÇ       ‚îî‚îÄ‚îÄ SE n√£o tem: solicitar comprimento\n  ‚îî‚îÄ‚îÄ SE \"metros\" OU \"m\":\n      ‚îî‚îÄ‚îÄ USAR quantidade diretamente\n```\n\n### ETAPA 3: CONVERS√ÉO DE TERMOS\n| Entrada | Sa√≠da Padronizada |\n|---------|-------------------|\n| F5, Ferro 5mm, 3/16\" | F5 |\n| F6, Ferro 6mm, 1/4\" | F6.3 |\n| F8, Ferro 8mm, 5/16\" | F8 |\n| F10, Ferro 10mm, 3/8\" | F10 |\n| F12, Ferro 12mm, 1/2\" | F12.5 |\n| 5/8\", F16 | F16 |\n| 3/4\", F20 | F20 |\n\n### ETAPA 4: PADR√ïES ESPECIAIS\n| Entrada | Interpreta√ß√£o | Sa√≠da |\n|---------|---------------|-------|\n| 3x8 | 3/8 polegadas | F10 |\n| 5x16 | 5/16 polegadas | F8 |\n| 1x4 | 1/4 polegadas | F6.3 |\n| 1x2 | 1/2 polegadas | F12.5 |\n\n## üèóÔ∏è REGRA CR√çTICA PARA DESCRI√á√ÉO DE FERRAGENS PERSONALIZADAS\n\n### QUANDO USAR A TOOL calcular_ferragem_personalizada:\n\n**OBRIGAT√ìRIO**: Use SEMPRE a descri√ß√£o t√©cnica retornada pela tool, mas PRESERVE a quantidade e comprimento originais do input.\n\n### PROCESSO DE VALIDA√á√ÉO:\n1. **EXTRAIR** do input: quantidade_original e comprimento_original\n2. **PROCESSAR** com tool calcular_ferragem_personalizada\n3. **VALIDAR** que a descri√ß√£o t√©cnica cont√©m o comprimento_original\n4. **CONSTRUIR** output com quantidade_original + descri√ß√£o t√©cnica + pre√ßo calculado\n5. **VERIFICAR** consist√™ncia final antes de retornar\n\n### FORMATO CORRETO:\n```json\n// Input: \"2 colunas de 4 metros com ferro 10, com estribo 7x20 e 15 cm\"\n// Extra√ß√£o: quantidade=2, comprimento=4.00\n\n// Tool retorna:\n{\n  \"descricao_ferragem\": \"Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\",\n  \"preco_venda\": 137.35\n}\n\n// Valida√ß√£o:\n// ‚úÖ Comprimento na descri√ß√£o (4.00) = comprimento_original (4.00)\n// ‚úÖ Quantidade preservada (2)\n\n// No or√ßamento final:\n\"* **2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2:** R$ 274.70\"\n```\n\n**NUNCA USE:**\n‚ùå \"2 Ferragem armada para coluna 4m com ferro F10, estribo 7x20...\"\n\n**SEMPRE USE:**\n‚úÖ \"2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\"\n\n## üîß CASOS ESPEC√çFICOS DE PROCESSAMENTO\n\n### CASO 1: FERRAGEM EM UNIDADES SEM COMPRIMENTO\n**INPUT**: \"10 ferragens 7x15 F10\"\n**PROCESSAMENTO**:\n```json\n{\n  \"interpretacao\": \"10 unidades de ferragem personalizada\",\n  \"dimensoes\": \"7x15 cm\",\n  \"bitola\": \"F10\",\n  \"quantidade_original\": 10,\n  \"status\": \"incompleto\",\n  \"dados_necessarios\": [\"comprimento de cada ferragem\"]\n}\n```\n\n### CASO 2: FERRAGEM EM UNIDADES COM COMPRIMENTO\n**INPUT**: \"5 ferragens 7x15 F10 de 3 metros cada\"\n**PROCESSAMENTO**:\n```json\n{\n  \"interpretacao\": \"5 unidades de ferragem personalizada\",\n  \"dimensoes\": \"7x15 cm\",\n  \"bitola\": \"F10\",\n  \"quantidade_original\": 5,\n  \"comprimento_original\": 3.0,\n  \"status\": \"completo\"\n}\n```\n\n## üßÆ C√ÅLCULO COM VALIDA√á√ÉO\n\n### REGRA DE C√ÅLCULO:\nQuando receber produtos como \"X treli√ßas de Y metros\":\n1. **EXTRAIR**: quantidade_original = X, comprimento_original = Y\n2. Calcule SEMPRE: quantidade √ó comprimento = metragem total\n3. Use a tool busca_preco para obter pre√ßo por metro\n4. Calcule: metragem_total √ó preco_por_metro = valor_final\n5. **VALIDAR**: output cont√©m quantidade_original e comprimento_original\n\n### EXEMPLO COM VALIDA√á√ÉO:\n- Input: \"38 treli√ßas de 2.50m\"\n- **Extra√ß√£o**: quantidade_original=38, comprimento_original=2.50\n- C√°lculo: 38 √ó 2.50 = 95 metros\n- Busca pre√ßo: R$ 13,00 por metro\n- Valor final: 95 √ó 13,00 = R$ 1.235,00\n- **Valida√ß√£o**: Output deve mostrar \"38\" e \"2.50m\"\n\n## üéØ FERRAMENTAS DISPON√çVEIS\n- `calcular_laje`: Projetos completos de laje\n- `busca_preco`: Produtos isolados e pre√ßos por metro\n- `calcular_ferragem_personalizada`: Ferragens n√£o-padr√£o\n- `produtos_mais_cotados`: Consulta produtos em alta\n- `salvar_orcamento`: Registro de or√ßamento finalizado\n\n## üö® REGRAS CR√çTICAS\n\n### ‚ùå NUNCA FA√áA:\n- Or√ßamento com placeholders \"[valor a ser calculado]\"\n- Usar valores estimados sem ferramentas\n- Mostrar c√°lculos no or√ßamento: (9 x R$ 65,00)\n- Processar produtos n√£o dispon√≠veis\n- Confundir \"unidades\" com \"metros\"\n- Assumir comprimento quando n√£o informado\n- **ALTERAR quantidade ou comprimento do input original**\n\n### ‚úÖ SEMPRE FA√áA:\n- Distinguir claramente UNIDADES vs METROS\n- **EXTRAIR e PRESERVAR quantidade e comprimento originais**\n- Para UNIDADES: verificar se tem comprimento especificado\n- Para METROS: usar quantidade diretamente\n- Aguardar retorno completo das ferramentas\n- Usar apenas valores num√©ricos reais\n- Converter termos antes de usar ferramentas\n- **VALIDAR consist√™ncia input ‚Üí output antes de retornar**\n\n## üìã FORMATO DE OR√áAMENTO - PADR√ÉO WhatsApp\n\n```\n**OR√áAMENTO MATERIAIS LAJE - Guardi√£o Lajes**\n\n* **[Quantidade_Original] [Item_Com_Tamanho_Original]:** R$ [Valor_Total]\n* **[Quantidade_Original] [Item_Com_Tamanho_Original]:** R$ [Valor_Total]\n\n**Total do Or√ßamento: R$ [Valor_Total_Geral]**\n\n*Produtos n√£o dispon√≠veis: [lista se houver]*\n```\n\n## üîÑ FLUXO DE DECIS√ÉO OTIMIZADO\n\n```\nINPUT recebido\n    ‚Üì\nEXTRAIR quantidade_original e comprimento_original\n    ‚Üì\nCont√©m \"ferragem\", \"treli√ßa\", \"verga\", \"contra-verga\" ou \"viga\"?\n    ‚Üì\n    SIM ‚Üí Verificar unidade de medida\n        ‚Üì\n        √â \"unidades\" ou n√∫mero sem \"metro\"?\n            ‚Üì\n            SIM ‚Üí Tem comprimento especificado?\n                ‚Üì\n                SIM ‚Üí Processar com comprimento + VALIDAR preserva√ß√£o\n                N√ÉO ‚Üí Solicitar comprimento\n            ‚Üì\n            N√ÉO ‚Üí √â \"metros\"?\n                ‚Üì\n                SIM ‚Üí Processar metragem diretamente + VALIDAR preserva√ß√£o\n    ‚Üì\nCONSTRUIR output com dados originais preservados\n    ‚Üì\nEXECUTAR checklist de valida√ß√£o\n    ‚Üì\nRETORNAR or√ßamento formatado\n```\n\n## üîß MANTRA T√âCNICO ATUALIZADO\n**\"EXTRAIR ‚Üí PROCESSAR ‚Üí VALIDAR ‚Üí PRESERVAR ‚Üí RETORNAR\"**\n\n**PROCESSO**: Extraio dados originais ‚Üí Identifico ‚Üí Classifico ‚Üí Verifico ‚Üí Solicito/Calculo ‚Üí Valido preserva√ß√£o ‚Üí Formato ‚Üí Retorno\n\n---\n\n**FOCO EXCLUSIVO**: Processamento t√©cnico de or√ßamentos com preserva√ß√£o obrigat√≥ria de quantidade e tamanho originais do input, garantindo consist√™ncia total entre entrada e sa√≠da de dados."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1080,
        0
      ],
      "id": "f08a55e7-dc51-418b-bf92-11227a4ca55b",
      "name": "or√ßamentos",
      "retryOnFail": true,
      "waitBetweenTries": 1500
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ff85f63a-9eea-4eb6-aaa3-e9616c791c00",
              "name": "id.workflowferramentas",
              "value": "4pdizWewQzdsLsGx",
              "type": "string"
            },
            {
              "id": "6a06262d-deb7-4493-bdc0-045c05773560",
              "name": "produtos",
              "value": "={{ $json.produtos }}",
              "type": "object"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        620,
        40
      ],
      "id": "db678a86-5c30-402a-8482-219a2510ac61",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "description": "=Busca o pre√ßo de um produto a partir do nome e especifica√ß√µes t√©cnicas. Use sempre que o cliente quiser saber pre√ßo de um item espec√≠fico. \nIMPORTANTE: \n- Para treli√ßas/ferragens em unidades, calcule PRIMEIRO a metragem total\n- Exemplo: 38 treli√ßas de 2.50m = 38 √ó 2.50 = 95 metros\n- Depois multiplique o pre√ßo por metro pela metragem total",
        "source": "=database",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "=preco_produto",
            "tableName": "produtos_precos",
            "NomeProduto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('NomeProduto', `Nome do produto que o cliente mencionou. Deve ser uma palavra-chave presente no nome cadastrado, como \"Ferragem F10\", \"Isopor H8\", \"Lajota\", \"Estribo\", etc.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        980,
        340
      ],
      "id": "a0298779-53cb-46f9-9162-5c89ec69da93",
      "name": "busca_preco"
    },
    {
      "parameters": {
        "name": "salvar_orcamento",
        "description": "=Salva um or√ßamento para um cliente com a lista de produtos cotados, pre√ßos, total e v√≠nculo com o lead correspondente.\nPara cada produto:\n- Identifique o nome exato (conforme a tabela de produtos).\n- Use o tool 'busca_produto' para consultar o pre√ßo na tabela 'produtos_precos'.\n- Calcule o subtotal: preco_unitario √ó quantidade.\n",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "salvar_orcamento",
            "tableName": "orcamentos",
            "leadid": "1",
            "Produtos": "={{ JSON.stringify($fromAI('produtos', `Gere a lista de produtos que o cliente deseja or√ßar. Para cada produto:\n- Identifique o nome exato (conforme a tabela de produtos).\n- Use o tool 'busca_produto' para consultar o pre√ßo na tabela 'produtos_precos'.\n- Calcule o subtotal: preco_unitario √ó quantidade.\n- Retorne os campos:\n\n[\n  {\n    \\\"nome\\\": \\\"Ferragem F10\\\",\n    \\\"quantidade\\\": 12,\n    \\\"unidade\\\": \\\"metro\\\",\n    \\\"detalhes\\\": {\n      \\\"bitola_estribo\\\": \\\"4.2mm\\\",\n      \\\"tamanho_estribo\\\": \\\"7x17\\\",\n    \\\"preco_unitario\\\": 25.00,\n    \\\"subtotal\\\": 300.00\n    }\n  },\n  ...\n]\n\nSe n√£o souber alguma especifica√ß√£o, deixe o campo 'detalhes' vazio ou omita.\nNunca estime valores manualmente. Sempre consulte o pre√ßo com 'busca_produto'.`, 'json')) }}",
            "Obs": "={{ $fromAI('observacoes', `Observa√ß√µes gerais sobre o or√ßamento solicitado. Inclua instru√ß√µes extras dadas pelo cliente, coment√°rios adicionais, condi√ß√µes especiais (como forma de pagamento ou prazo), ou qualquer informa√ß√£o que ajude o setor comercial ou log√≠stica. Se o cliente n√£o disser nada relevante, retorne string vazia.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "id": "192e8725-220c-421d-ab77-eb5d490591fe",
      "name": "salvar_orcamento",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1080,
        360
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "description": "Calcula a quantidade estimada de materiais para montagem de uma laje, com base nas dimens√µes informadas\n  (largura e comprimento, ou apenas √°rea) e no tipo de enchimento escolhido (isopor ou lajota cer√¢mica).\n  Retorna a quantidade aproximada de vigotas, pe√ßas de enchimento (isopor ou lajota) e malhas de a√ßo necess√°rias.\n  Sempre que houver largura e comprimento, o c√°lculo ser√° feito com base no espa√ßamento real entre as vigotas.",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "calcLaje",
            "especificacoes": "={\n\"largura\": \"{{ $fromAI('largura', 'largura da laje em metros. Ex: 5', 'string') }}\",\n\"comprimento\": \"{{ $fromAI('comprimento', 'comprimento da laje em metros. Ex: 8', 'string') }}\",\n\"area\": \"{{ $fromAI('area', '√°rea total da laje em metros quadrados. Ex: 40. Use apenas se n√£o houver largura e comprimento.', 'string') }}\",\n\"enchimento\": \"{{ $fromAI('enchimento', 'tipo de enchimento da laje: \\\"isopor\\\" ou \\\"lajota\\\". Se o cliente n√£o disser, use \\\"isopor\\\" como padr√£o.', 'string', { default: 'isopor' }) }}\",\n\"malha\": \"{{ $fromAI('malha'), 'qual √© o modelo de malha ex:\"Leve 20x20 F3.4\", \"Media 15x15 F3.4\" ou \"Refor√ßada 15x15 F4.2\"', 'string', { default: 'Media' } }}\"\n}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1280,
        360
      ],
      "id": "ef152a0c-3811-4a0e-afd1-de55b103892d",
      "name": "calcular_laje"
    },
    {
      "parameters": {
        "description": "=Calcula o custo e o pre√ßo estimado de uma ferragem sob medida com base em comprimento, \n  ferros longitudinais (bitola e quantidade), tamanho e bitola dos estribos, espa√ßamento entre estribos,\n  custos de material e m√£o de obra. Caso a bitola dos estribos n√£o seja informada, usa-se \"F4.2\" como padr√£o, e se o espa√ßo entre os estribos n√£o for informada, usa-se \"0.20\", se o a quantidade de ferros n√£o for informada considere como padr√£o 4",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "CalcFer",
            "ferragem": "={\n  \"comprimento\": {{ $fromAI(\"comprimento\", \"Comprimento total da ferragem em metros. Ex: para 'Ferragem 5,00', o valor √© 5.\", \"number\") }},\n  \"ferros_longitudinais\": {{ $fromAI(\"ferros_longitudinais\", \"Lista de ferros longitudinais utilizados na ferragem. Cada item deve conter: - bitola (ex: 'F10', 'F12', 'F8', etc) - quantidade de var√µes dessa bitola. Formato: [ { \\\"bitola\\\": \\\"F10\\\", \\\"quantidade\\\": 4 }, { \\\"bitola\\\": \\\"F12\\\", \\\"quantidade\\\": 2 } ] Extraia mesmo que o cliente envie como '4F10+2F12', converta para este array e envie como string JSON. se n√£o a quantidade de ferros n√£o vinhe informado considere que √© 4\", \"string\") }},\n  \"tamanho_estribo\": \"{{ $fromAI(\"tamanho_estribo\", \"Tamanho do estribo no formato 'largura x altura' em cm. Ex: '7x20'.\", \"string\") }}\",\n  \"espacamento_estribo\": \"{{ $fromAI(\"espacamento_estribo\", \"Espa√ßamento entre estribos em metros. Ex: para 'a cd 0,15', o valor √© 0.15. Se n√£o for informado, use o padr√£o '0.20'.\", \"number\") }}\",\n  \"bitola_estribo\": \"{{ $fromAI(\"bitola_estribo\", \"Bitola do ferro do estribo (ex: 'F5'). Se n√£o for informado, use o padr√£o 'F4.2'.\", \"string\") }}\"\n}\n"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1400,
        340
      ],
      "id": "c13462d1-a5ce-4458-8198-3e435229fbe7",
      "name": "calcular_ferragem_personalizada"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Mostra os produtos mais cotados em or√ßamentos recentes dos √∫ltimos 30 dias.",
        "operation": "executeQuery",
        "query": "SELECT\n  produto ->> 'nome' AS produto,\n  COUNT(*) AS total\nFROM\n  orcamentos,\n  jsonb_array_elements(produtos) AS produto\nWHERE\n  data > NOW() - INTERVAL '30 days'\nGROUP BY\n  produto\nORDER BY\n  total DESC\nLIMIT 5;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1180,
        340
      ],
      "id": "0b86182a-b2c1-493f-872a-f01728cc52b7",
      "name": "produtos_mais_cotados",
      "credentials": {
        "postgres": {
          "id": "z2oHR8Hcbud4cXb6",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        880,
        280
      ],
      "id": "a3e2731a-9262-4e97-8463-67be9e83b25e",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "GOTIgGndJIkf9Pqy",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        1540,
        340
      ],
      "id": "f2dd64d0-4d30-4769-8159-ca0aad82acca",
      "name": "Calculator"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        340,
        260
      ],
      "id": "b5a84fb8-3a54-415b-a68c-55750a322f24",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "3mNlZ20nDfXfgUl9",
          "name": "OpenAi account"
        }
      }
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "or√ßamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calcular_ferragem_personalizada": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "calcular_laje": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "salvar_orcamento": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "busca_preco": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "produtos_mais_cotados": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "produtos": "  {\n\"lista_produtos\": \"03 treli√ßas de 6 metros cheia, 100 lajotas de barro, 01 malha de 3x2, 1 kg de arame queimado, 01 ferragem armada 7x15 ferro 3/8\", 2 vergalh√£o de 5/16\"\",\n  \"tipo_projeto\": \"misto\",\n  \"dimensoes_laje\": \"\"\n}"
        }
      }
    ]
  },
  "versionId": "27d08c88-d244-41de-8111-6b550cb32743",
  "triggerCount": 0,
  "tags": []
}