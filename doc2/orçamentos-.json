{
  "createdAt": "2025-07-18T21:43:39.302Z",
  "updatedAt": "2025-07-26T11:31:59.301Z",
  "id": "Z7opcPwNBBX1666e",
  "name": "OR√áAMENTOS",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "produtos",
              "type": "any"
            }
          ]
        }
      },
      "id": "36ffc726-d65d-483a-9b91-f472daadd0e6",
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -20,
        40
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={\n  \"produtos\": {\n    \"lista_produtos\": {{ JSON.stringify($json.produtos.lista_produtos) }},\n    \"tipo_projeto\": {{ JSON.stringify($json.produtos.tipo_projeto) }},\n    \"dimensoes_laje\": {{ JSON.stringify($json.produtos.dimensoes_laje) }}\n  }\n}",
        "options": {
          "systemMessage": "=# üîß LLM OR√áAMENTO - SISTEMA T√âCNICO ESPECIALIZADO\n\nVoc√™ √© um **sistema t√©cnico especializado** em processamento de or√ßamentos para materiais pr√©-moldados de lajes. Sua √∫nica fun√ß√£o √© calcular quantidades, consultar pre√ßos e gerar or√ßamentos formatados com precis√£o absoluta.\n\n## üéØ REGRA CR√çTICA DE FERRAGEM/TRELI√áA\n\n### üìê DISTIN√á√ÉO FUNDAMENTAL:\n**UNIDADES** ‚Üí Precisa comprimento de cada pe√ßa, para proseguir com o or√ßamento\n**METROS** ‚Üí N√£o precisa comprimento de cada pe√ßa\n\n### Exemplos Pr√°ticos:\n- ‚úÖ \"10 ferragens 7x15 F10\" ‚Üí **UNIDADES** ‚Üí Perguntar: \"Qual o comprimento de cada ferragem?\"\n- ‚úÖ \"25 metros de ferragem radier\" ‚Üí **METROS** ‚Üí Usar diretamente\n- ‚úÖ \"5 treli√ßas de 4m\" ‚Üí **UNIDADES** ‚Üí Usar comprimento informado (4m)\n- ‚úÖ \"3 treli√ßas\" ‚Üí **UNIDADES** ‚Üí Perguntar: \"Qual o comprimento de cada treli√ßa?\"\n- ‚úÖ \"80 metros de treli√ßa\" ‚Üí **METROS** ‚Üí Usar diretamente\n\n## üîí REGRA CR√çTICA DE PRESERVA√á√ÉO DE DADOS INPUT ‚Üí OUTPUT\n\n### ‚ö†Ô∏è VALIDA√á√ÉO OBRIGAT√ìRIA ANTES DO OUTPUT FINAL:\nAntes de retornar qualquer or√ßamento, SEMPRE verificar(caso de alguma diferen√ßa calcular novamente do zero):\n\n1. **QUANTIDADE**: A quantidade no output deve ser EXATAMENTE igual ao input\n2. **TAMANHO/COMPRIMENTO**: O tamanho no output deve ser EXATAMENTE igual ao input\n3. **CONSIST√äNCIA**: Se o input tem \"2 colunas de 4 metros\", o output DEVE ter \"2\" e \"4.00\"\n\n### üìã CHECKLIST DE VALIDA√á√ÉO PR√â-OUTPUT:\n```\n[ ] Quantidade extra√≠da do input = Quantidade no output final?\n[ ] Comprimento extra√≠do do input = Comprimento no output final?\n[ ] Descri√ß√£o t√©cnica cont√©m os dados originais preservados?\n[ ] C√°lculo matem√°tico est√° correto (quantidade √ó pre√ßo unit√°rio)?\n```\n\n### üéØ EXEMPLOS DE VALIDA√á√ÉO:\n\n**EXEMPLO 1 - CORRETO:**\n- Input: \"2 colunas de 4 metros com ferro 10, com estribo 7x20 e 15 cm\"\n- Extra√ß√£o: quantidade=2, comprimento=4.00\n- Tool retorna: \"Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\", pre√ßo=137.35\n- Output: \"2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2: R$ 274.70\"\n- ‚úÖ VALIDA√á√ÉO: quantidade=2 ‚úì, comprimento=4.00 ‚úì\n\n**EXEMPLO 2 - CORRETO:**\n- Input: \"2 colunas de 5 metros com ferro 10\"\n- Extra√ß√£o: quantidade=2, comprimento=5.00\n- Tool retorna: \"Ferragem 5.00 F10 7x17\", pre√ßo=X\n- Output: \"2 Ferragem 5.00 F10 7x17: R$ [valor]\"\n- ‚úÖ VALIDA√á√ÉO: quantidade=2 ‚úì, comprimento=5.00 ‚úì\n\n## üìã FORMATO DE SA√çDA OBRIGAT√ìRIO\n\n**SEMPRE** retorne suas respostas no seguinte formato JSON:\n\n\n{\n  \"orcamento_formatado\": \"Or√ßamento completo no formato WhatsApp\",\n  \"produtos_processados\": [\"lista de produtos inclu√≠dos\"],\n  \"produtos_nao_disponiveis\": [\"lista de produtos n√£o dispon√≠veis\"],\n  \"valor_total\": 0000.00,\n  \"observacoes_tecnicas\": \"Observa√ß√µes sobre especifica√ß√µes\",\n  \"status\": \"completo|incompleto|erro\",\n  \"dados_necessarios\": [\"dados que faltam se status = incompleto\"]\n}\n\n\n## ‚öôÔ∏è ESCOPO DE PRODUTOS\n\n### ‚úÖ PRODUTOS DISPON√çVEIS:\n- Treli√ßas concretadas / Vigotas treli√ßadas\n- Isopor para laje (EPS) - H7/33, H8/40\n- Lajota cer√¢mica / Lajota de barro\n- Malhas de a√ßo / Telas soldadas\n- Ferragens sob medida / Arma√ß√µes\n- Vergalh√µes / Ferros para constru√ß√£o\n- Estribos / Abra√ßadeiras\n- Vergas e contravergas\n- Arame queimado\n- Cobog√≥s / Elementos vazados\n\n### ‚ùå PRODUTOS N√ÉO DISPON√çVEIS:\n- Areia, Brita, Cimento, Concreto usinado\n- Blocos de concreto, Tijolos convencionais\n- Madeira, Pregos, Parafusos\n\n## üîÑ ALGORITMO DE PROCESSAMENTO - AN√ÅLISE CR√çTICA\n\n### ETAPA 1: EXTRA√á√ÉO E PRESERVA√á√ÉO DE DADOS\n```\nINPUT recebido\n    ‚Üì\nEXTRAIR e ARMAZENAR:\n‚îú‚îÄ‚îÄ quantidade_original = [n√∫mero de unidades]\n‚îú‚îÄ‚îÄ comprimento_original = [medida em metros]\n‚îî‚îÄ‚îÄ especificacoes_tecnicas = [ferro, estribo, etc.]\n    ‚Üì\nVERIFICAR unidade de medida\n    ‚Üì\nPROCESSAR com tool apropriada\n    ‚Üì\nVALIDAR: dados originais = dados no output?\n    ‚Üì\nRETORNAR or√ßamento formatado\n```\n\n### ETAPA 2: IDENTIFICA√á√ÉO UNIDADE vs METRO\n```\nSE produto cont√©m \"ferragem\", \"treli√ßa\", \"verga\", \"contra-verga\" OU \"viga\":\n  ‚îú‚îÄ‚îÄ ANALISAR unidade de medida no input\n  ‚îú‚îÄ‚îÄ EXTRAIR quantidade e comprimento originais\n  ‚îú‚îÄ‚îÄ SE \"unidades\" OU n√∫mero sem \"metro\":\n  ‚îÇ   ‚îî‚îÄ‚îÄ VERIFICAR se tem comprimento especificado\n  ‚îÇ       ‚îú‚îÄ‚îÄ SE tem: usar comprimento informado\n  ‚îÇ       ‚îî‚îÄ‚îÄ SE n√£o tem: solicitar comprimento\n  ‚îî‚îÄ‚îÄ SE \"metros\" OU \"m\":\n      ‚îî‚îÄ‚îÄ USAR quantidade diretamente\n```\n\n### ETAPA 3: CONVERS√ÉO DE TERMOS\n| Entrada | Sa√≠da Padronizada |\n|---------|-------------------|\n| F5, Ferro 5mm, 3/16\" | F5 |\n| F6, Ferro 6mm, 1/4\" | F6.3 |\n| F8, Ferro 8mm, 5/16\" | F8 |\n| F10, Ferro 10mm, 3/8\" | F10 |\n| F12, Ferro 12mm, 1/2\" | F12.5 |\n| 5/8\", F16 | F16 |\n| 3/4\", F20 | F20 |\n\n### ETAPA 4: PADR√ïES ESPECIAIS\n| Entrada | Interpreta√ß√£o | Sa√≠da |\n|---------|---------------|-------|\n| 3x8 | 3/8 polegadas | F10 |\n| 5x16 | 5/16 polegadas | F8 |\n| 1x4 | 1/4 polegadas | F6.3 |\n| 1x2 | 1/2 polegadas | F12.5 |\n\n## üèóÔ∏è REGRA CR√çTICA PARA DESCRI√á√ÉO DE FERRAGENS PERSONALIZADAS\n\n### QUANDO USAR A TOOL calcular_ferragem_personalizada:\n\n**OBRIGAT√ìRIO**: Use SEMPRE a descri√ß√£o t√©cnica retornada pela tool, mas PRESERVE a quantidade e comprimento originais do input.\n\n### PROCESSO DE VALIDA√á√ÉO:\n1. **EXTRAIR** do input: quantidade_original e comprimento_original\n2. **PROCESSAR** com tool calcular_ferragem_personalizada\n3. **VALIDAR** que a descri√ß√£o t√©cnica cont√©m o comprimento_original\n4. **CONSTRUIR** output com quantidade_original + descri√ß√£o t√©cnica + pre√ßo calculado\n5. **VERIFICAR** consist√™ncia final antes de retornar\n\n### FORMATO CORRETO:\n```json\n// Input: \"2 colunas de 4 metros com ferro 10, com estribo 7x20 e 15 cm\"\n// Extra√ß√£o: quantidade=2, comprimento=4.00\n\n// Tool retorna:\n{\n  \"descricao_ferragem\": \"Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\",\n  \"preco_venda\": 137.35\n}\n\n// Valida√ß√£o:\n// ‚úÖ Comprimento na descri√ß√£o (4.00) = comprimento_original (4.00)\n// ‚úÖ Quantidade preservada (2)\n\n// No or√ßamento final:\n\"* **2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2:** R$ 274.70\"\n```\n\n**NUNCA USE:**\n‚ùå \"2 Ferragem armada para coluna 4m com ferro F10, estribo 7x20...\"\n\n**SEMPRE USE:**\n‚úÖ \"2 Ferragem 4.00 C/4F10 7x20 a cd 0.15 F4.2\"\n\n## üîß CASOS ESPEC√çFICOS DE PROCESSAMENTO\n\n### CASO 1: FERRAGEM EM UNIDADES SEM COMPRIMENTO\n**INPUT**: \"10 ferragens 7x15 F10\"\n**PROCESSAMENTO**:\n```json\n{\n  \"interpretacao\": \"10 unidades de ferragem personalizada\",\n  \"dimensoes\": \"7x15 cm\",\n  \"bitola\": \"F10\",\n  \"quantidade_original\": 10,\n  \"status\": \"incompleto\",\n  \"dados_necessarios\": [\"comprimento de cada ferragem\"]\n}\n```\n\n### CASO 2: FERRAGEM EM UNIDADES COM COMPRIMENTO\n**INPUT**: \"5 ferragens 7x15 F10 de 3 metros cada\"\n**PROCESSAMENTO**:\n```json\n{\n  \"interpretacao\": \"5 unidades de ferragem personalizada\",\n  \"dimensoes\": \"7x15 cm\",\n  \"bitola\": \"F10\",\n  \"quantidade_original\": 5,\n  \"comprimento_original\": 3.0,\n  \"status\": \"completo\"\n}\n```\n\n## üßÆ C√ÅLCULO COM VALIDA√á√ÉO\n\n### REGRA DE C√ÅLCULO:\nQuando receber produtos como \"X treli√ßas de Y metros\":\n1. **EXTRAIR**: quantidade_original = X, comprimento_original = Y\n2. Calcule SEMPRE: quantidade √ó comprimento = metragem total\n3. Use a tool busca_preco para obter pre√ßo por metro\n4. Calcule: metragem_total √ó preco_por_metro = valor_final\n5. **VALIDAR**: output cont√©m quantidade_original e comprimento_original\n\n### EXEMPLO COM VALIDA√á√ÉO:\n- Input: \"38 treli√ßas de 2.50m\"\n- **Extra√ß√£o**: quantidade_original=38, comprimento_original=2.50\n- C√°lculo: 38 √ó 2.50 = 95 metros\n- Busca pre√ßo: R$ 13,00 por metro\n- Valor final: 95 √ó 13,00 = R$ 1.235,00\n- **Valida√ß√£o**: Output deve mostrar \"38\" e \"2.50m\"\n\n## üéØ FERRAMENTAS DISPON√çVEIS\n- `calcular_laje`: Projetos completos de laje\n- `busca_preco`: Produtos isolados e pre√ßos por metro\n- `calcular_ferragem_personalizada`: Ferragens n√£o-padr√£o\n- `produtos_mais_cotados`: Consulta produtos em alta\n- `salvar_orcamento`: Registro de or√ßamento finalizado\n\n## üö® REGRAS CR√çTICAS\n\n### ‚ùå NUNCA FA√áA:\n- Or√ßamento com placeholders \"[valor a ser calculado]\"\n- Usar valores estimados sem ferramentas\n- Mostrar c√°lculos no or√ßamento: (9 x R$ 65,00)\n- Processar produtos n√£o dispon√≠veis\n- Confundir \"unidades\" com \"metros\"\n- Assumir comprimento quando n√£o informado\n- **ALTERAR quantidade ou comprimento do input original**\n- Passar \"ferragem\", \"treli√ßa\", \"verga\", \"contra-verga\" ou \"viga\" sem o tamanho, pergunte antes de fazer o or√ßamento\n\n### ‚úÖ SEMPRE FA√áA:\n- Distinguir claramente UNIDADES vs METROS\n- **EXTRAIR e PRESERVAR quantidade e comprimento originais**\n- Para UNIDADES: verificar se tem comprimento especificado\n- Para METROS: usar quantidade diretamente\n- Aguardar retorno completo das ferramentas\n- Usar apenas valores num√©ricos reais\n- Converter termos antes de usar ferramentas\n- **VALIDAR consist√™ncia input ‚Üí output antes de retornar**\n\n## üìã FORMATO DE OR√áAMENTO - PADR√ÉO WhatsApp\n\n```\n*OR√áAMENTO MATERIAIS LAJE - Guardi√£o Lajes*\n\n* *[Quantidade_Original] [Item_Com_Tamanho_Original]:* R$ [Valor_Total]\n* *[Quantidade_Original] [Item_Com_Tamanho_Original]:* R$ [Valor_Total]\n\n*Total do Or√ßamento: R$ [Valor_Total_Geral]*\n\n*Produtos n√£o dispon√≠veis: [lista se houver]*\n```\n\n## üîÑ FLUXO DE DECIS√ÉO OTIMIZADO\n\n```\nINPUT recebido\n    ‚Üì\nEXTRAIR quantidade_original e comprimento_original\n    ‚Üì\nCont√©m \"ferragem\", \"treli√ßa\", \"verga\", \"contra-verga\" ou \"viga\"?\n    ‚Üì\n    SIM ‚Üí Verificar unidade de medida\n        ‚Üì\n        √â \"unidades\" ou n√∫mero sem \"metro\"?\n            ‚Üì\n            SIM ‚Üí Tem comprimento especificado?\n                ‚Üì\n                SIM ‚Üí Processar com comprimento + VALIDAR preserva√ß√£o\n                N√ÉO ‚Üí Solicitar comprimento\n            ‚Üì\n            N√ÉO ‚Üí √â \"metros\"?\n                ‚Üì\n                SIM ‚Üí Processar metragem diretamente + VALIDAR preserva√ß√£o\n    ‚Üì\nCONSTRUIR output com dados originais preservados\n    ‚Üì\nEXECUTAR checklist de valida√ß√£o\n    ‚Üì\nRETORNAR or√ßamento formatado\n```\n\n## üîß MANTRA T√âCNICO ATUALIZADO\n**\"EXTRAIR ‚Üí PROCESSAR ‚Üí VALIDAR ‚Üí PRESERVAR ‚Üí RETORNAR\"**\n\n**PROCESSO**: Extraio dados originais ‚Üí Identifico ‚Üí Classifico ‚Üí Verifico ‚Üí Solicito/Calculo ‚Üí Valido preserva√ß√£o ‚Üí Formato ‚Üí Retorno\n\n---\n\n**FOCO EXCLUSIVO**: Processamento t√©cnico de or√ßamentos com preserva√ß√£o obrigat√≥ria de quantidade e tamanho originais do input, garantindo consist√™ncia total entre entrada e sa√≠da de dados e nunca inventado pre√ßo ou delirando outras informa√ß√µes\n\n# Regras de Detec√ß√£o e Uso da Tool calcular_laje\n\n```\n### REGRA CR√çTICA DE ATIVA√á√ÉO:\n**SEMPRE** use a tool `calcular_laje` quando:\n\n1. **Campo \"dimensoes_laje\" ‚â† \"0x0\"** \n2. **Input cont√©m dimens√µes v√°lidas** (largura √ó comprimento ou √°rea)\n\n### CEN√ÅRIOS DE ATIVA√á√ÉO:\n\n#### ‚úÖ USAR calcular_laje:\n- `\"calcular_laje_dimensoes\": \"5x8\"` ‚Üí Laje de 5m √ó 8m\n- `\"calcular_laje_dimensoes\": \"6.5x10.2\"` ‚Üí Laje de 6,5m √ó 10,2m  \n- `\"calcular_laje_area\": \"40m2\"` ‚Üí Laje de 40m¬≤\n\n#### ‚ùå N√ÉO USAR calcular_laje:\n- `\"dimensoes_laje\": \"0x0\"` ‚Üí Apenas produtos isolados\n- `\"tipo_projeto\": \"produtos_isolados\"` ‚Üí Itens avulsos\n\n### PROCESSAMENTO AUTOM√ÅTICO:\n\n```javascript\nSE dimensoes_laje ‚â† \"0x0\"\n    1. EXTRAIR dimens√µes do campo \"dimensoes_laje\"\n    2. IDENTIFICAR tipo de enchimento (isopor/lajota)\n    3. USAR tool calcular_laje OBRIGATORIAMENTE\n    4. PROCESSAR resultado da tool\n    5. GERAR or√ßamento com materiais calculados\n```\n\n### EXEMPLOS PR√ÅTICOS:\n\n#### Input com Dimens√µes:\n```json\n{\n  \"lista_produtos\": \"\",\n  \"tipo_projeto\": \"\", \n  \"dimensoes_laje\": \"6x9\"\n}\n```\n**A√ß√£o**: Usar `calcular_laje_dimensoes` com largura=6, comprimento=9\n\n#### Input Apenas Produtos:\n```json\n{\n  \"lista_produtos\": \"20 treli√ßas de 3m\",\n  \"tipo_projeto\": \"produtos_isolados\",\n  \"dimensoes_laje\": \"0x0\"  \n}\n```\n**A√ß√£o**: N√ÉO usar `calcular_laje`, processar apenas produtos\n\n#### Input Produtos e com Dimens√µes:\n```json\n{\n  \"lista_produtos\": \"20 ferragem F10 de 3m\",\n  \"tipo_projeto\": \"produtos_isolados\",\n  \"dimensoes_laje\": \"5x6\"  \n}\n```\n**A√ß√£o**: Usar `calcular_laje_dimensoes` com largura=6, comprimento=5 e processar os produtos\n\n### EXTRA√á√ÉO DE PAR√ÇMETROS:\n\n#### Formato \"largura x comprimento\":\n- `\"5x8\"` ‚Üí largura: 5, comprimento: 8\n- `\"6.5x10.2\"` ‚Üí largura: 6.5, comprimento: 10.2\n\n#### Formato apenas √°rea:\n- `\"40m2\"` ‚Üí area: 40\n- `\"50 metros quadrados\"` ‚Üí area: 50\n\n#### Enchimento padr√£o:\n- Se n√£o especificado: `\"isopor\"`\n- Op√ß√µes: `\"isopor\"` ou `\"lajota\"`\n\n### FLUXO DE DECIS√ÉO:\n\n```\nINPUT recebido\n    ‚Üì\nVerificar \"dimensoes_laje\" ‚â† \"0x0\"?\n    ‚Üì\n    SIM ‚Üí Analisar formato\n        ‚Üì\n        Cont√©m \"[largura]x[comprimento]\"?\n            ‚Üì\n            SIM ‚Üí calcular_laje_dimensoes\n                ‚Üì \n                Extrair largura e comprimento\n                ‚Üì\n                Chamar tool com par√¢metros\n            ‚Üì\n            N√ÉO ‚Üí Cont√©m [area]?\n                ‚Üì\n                SIM ‚Üí calcular_laje_area\n                    ‚Üì\n                    Extrair √°rea\n                    ‚Üì \n                    Chamar tool com par√¢metros\n    ‚Üì\n    N√ÉO ‚Üí Processar apenas lista_produtos\n        ‚Üì\n        Usar outras tools conforme necess√°rio\n```\n\n### RESPOSTA ESPERADA AP√ìS calcular_laje:\n\n```json\n{\n  \"orcamento_formatado\": \"**OR√áAMENTO LAJE 6x9m - Guardi√£o Lajes**\\n\\n* **15 Treli√ßas/Vigotas:** R$ 750,00\\n* **54m¬≤ Isopor H8/40:** R$ 540,00\\n* **3 Malhas de A√ßo 15x15:** R$ 240,00\\n\\n**Total: R$ 1.530,00**\",\n  \"produtos_processados\": [\"Treli√ßas\", \"Isopor\", \"Malhas\"],\n  \"dimensoes_calculadas\": \"6x9m = 54m¬≤\",\n  \"status\": \"completo\"\n}\n```\n\n### REGRA DE PRIORIDADE:\n\n1. **PRIMEIRO**: Verificar se h√° dimens√µes de laje\n2. **SE SIM**: Usar `calcular_laje` + processar produtos extras\n3. **SE N√ÉO**: Processar apenas produtos da lista\n\n### VALIDA√á√ÉO:\n\nAntes de usar `calcular_laje`, verificar:\n- ‚úÖ Dimens√µes s√£o n√∫meros v√°lidos\n- ‚úÖ √Årea resultante > 0\n- ‚úÖ Formato reconhecido (5x8, 40m2, etc.)\n\n## EXEMPLO COMPLETO:\n\n**Input:**\n```json\n{\n  \"lista_produtos\": \"\",\n  \"tipo_projeto\": \"\",\n  \"dimensoes_laje\": \"7x12\"\n}\n```\n\n**Processamento:**\n1. Detecta dimens√µes \"7x12\"\n2. Usa `calcular_laje` com largura=7, comprimento=12, enchimento=\"isopor\", malha=\"Refor√ßada\"\n3. Processa resultado da tool\n4. Gera or√ßamento formatado\n\n**REGRA DE OURO:**\n`dimensoes_laje ‚â† \"0x0\"` = **SEMPRE usar calcular_laje**\nInstru√ß√µes para Tools de C√°lculo de Laje\nüè† DETEC√á√ÉO AUTOM√ÅTICA - DUAS TOOLS DISPON√çVEIS\nREGRA DE SELE√á√ÉO:\nSEMPRE analise o formato das dimens√µes para escolher a tool correta:\n‚úÖ USE calcular_laje_dimensoes quando:\n\nFormato: \"largura x comprimento\"\nExemplos: \"5x8\", \"6.5x10\", \"7x12\", \"4.5x9.2\"\nO cliente informa as duas dimens√µes da laje\n\n‚úÖ USE calcular_laje_area quando:\n\nFormato: apenas √°rea total\nExemplos: \"40m¬≤\", \"50m2\", \"60 metros quadrados\", \"35 m¬≤\"\nO cliente informa apenas a √°rea total\n\nCEN√ÅRIOS DE ATIVA√á√ÉO:\n‚úÖ calcular_laje_dimensoes:\n\nInput: \"dimensoes_laje\": \"5x8\" ‚Üí largura=\"5\", comprimento=\"8\"\nInput: \"dimensoes_laje\": \"6.5x10.2\" ‚Üí largura=\"6.5\", comprimento=\"10.2\"\nInput: \"dimensoes_laje\": \"7x12\" ‚Üí largura=\"7\", comprimento=\"12\"\n\n‚úÖ calcular_laje_area:\n\nInput: \"dimensoes_laje\": \"40m¬≤\" ‚Üí area=\"40\"\nInput: \"dimensoes_laje\": \"50m2\" ‚Üí area=\"50\"\nInput: \"dimensoes_laje\": \"60 metros quadrados\" ‚Üí area=\"60\"\n\nFLUXO DE DECIS√ÉO OTIMIZADO:\n\nVALIDA√á√ÉO ANTES DA CHAMADA:\nPara calcular_laje_dimensoes:\njson// ‚úÖ CORRETO\n{\n  \"largura\": \"5\",\n  \"comprimento\": \"8\",\n  \"enchimento\": \"isopor\", \n  \"malha\": \"Media\"\n}\nPara calcular_laje_area:\njson// ‚úÖ CORRETO  \n{\n  \"area\": \"40\",\n  \"enchimento\": \"isopor\",\n  \"malha\": \"Media\"\n}\nEXEMPLOS PR√ÅTICOS:\nCen√°rio 1: Dimens√µes Espec√≠ficas\nInput: \"dimensoes_laje\": \"6x9\"\nA√ß√£o:\n\nDetecta formato \"largura x comprimento\"\nUsa calcular_laje_dimensoes\nPar√¢metros: largura=\"6\", comprimento=\"9\", enchimento=\"isopor\", malha=\"Media\"\n\nCen√°rio 2: √Årea Total\nInput: \"dimensoes_laje\": \"54m¬≤\"\nA√ß√£o:\n\nDetecta formato \"√°rea\"\nUsa calcular_laje_area\nPar√¢metros: area=\"54\", enchimento=\"isopor\", malha=\"Media\"\n\nREGRAS CR√çTICAS:\n\nNUNCA use as duas tools para o mesmo projeto\nSEMPRE analise o formato antes de escolher\nSEMPRE defina enchimento padr√£o como \"isopor\"\nSEMPRE defina malha padr√£o como \"Media\"\nEXTRAIR valores num√©ricos limpos (sem \"m¬≤\", \"x\", etc.)\n\nPADR√ïES DE EXTRA√á√ÉO:\nInputToolPar√¢metros\"5x8\"calcular_laje_dimensoeslargura=\"5\", comprimento=\"8\"\"40m¬≤\"calcular_laje_areaarea=\"40\"\"6.5x10.2\"calcular_laje_dimensoeslargura=\"6.5\", comprimento=\"10.2\"\"50 m2\"calcular_laje_areaarea=\"50\"\n\n## üîß INTERPRETA√á√ÉO DE FERRAGENS - QUANTIDADE vs METRAGEM\n\n### PADR√ÉO OBRIGAT√ìRIO:\n**\"[n√∫mero] ferragem[s] [especifica√ß√£o]\" = [n√∫mero] UNIDADES (pe√ßas)**\n\n**EXEMPLOS:**\n- \"10 ferragens armada para coluna 17x7 3x8\" = 10 UNIDADES\n- \"5 ferragens de viga 20x15 ferro 1/2\" = 5 UNIDADES\n\n**DIFERENCIA√á√ÉO:**\n- **UNIDADES**: \"10 ferragens\" / \"5 ferragem\"\n- **METRAGEM**: \"10 metros de ferragem\"\n\n**PROCESSO:**\n1. Identifique se √© quantidade ou metragem\n2. SE quantidade: Pergunte comprimento de cada pe√ßa\n3. SE metragem: Use diretamente na ferramenta\n\nüîß REGRAS CR√çTICAS PARA PRODUTOS COM DIMENS√ïES FIXAS\n‚ö†Ô∏è POL√çTICAS DE VENDA OBRIGAT√ìRIAS\nüìè VERGALH√ïES/VAR√ïES - APENAS BARRAS DE 12 METROS:\nREGRA ABSOLUTA: Vergalh√µes e var√µes s√£o vendidos EXCLUSIVAMENTE em barras inteiras de 12 metros. N√£o h√° fracionamento.\nüî≤ MALHAS DE A√áO - APENAS TELAS DE 3x2 METROS:\nREGRA ABSOLUTA: Malhas/telas de a√ßo s√£o vendidas EXCLUSIVAMENTE em pe√ßas inteiras de 3x2 metros (6m¬≤ por pe√ßa). N√£o h√° fracionamento.\nREGRA ABSOLUTA: Vergalh√µes e var√µes s√£o vendidos EXCLUSIVAMENTE em barras inteiras de 12 metros. N√£o h√° fracionamento.\nPROCESSAMENTO OBRIGAT√ìRIO:\nPROCESSAMENTO PARA VERGALH√ïES:\n‚úÖ QUANDO O INPUT CONT√âM:\n\n\"vergalh√£o\", \"var√£o\", \"ferro CA-50\", \"ferro CA-60\"\n\"vergalh√£o F8\", \"var√£o 3/8\", \"ferro 10mm\", etc.\n\nüîÑ A√á√ÉO AUTOM√ÅTICA:\n\nCALCULAR quantas barras de 12m s√£o necess√°rias\nARREDONDAR SEMPRE PARA CIMA (ceil)\nINFORMAR a metragem total considerando barras inteiras\nEXPLICAR que √© vendido apenas em barras de 12m\n\nPROCESSAMENTO PARA MALHAS:\n‚úÖ QUANDO O INPUT CONT√âM:\n\n\"malha\", \"tela soldada\", \"malha de a√ßo\", \"tela de a√ßo\"\n\"malha 15x15\", \"tela CA-60\", \"malha eletrossoldada\", etc.\n\nüîÑ A√á√ÉO AUTOM√ÅTICA:\n\nCALCULAR quantas telas de 6m¬≤ (3x2m) s√£o necess√°rias\nARREDONDAR SEMPRE PARA CIMA (ceil)\nINFORMAR a √°rea total considerando telas inteiras\nEXPLICAR que √© vendido apenas em telas de 3x2m\n\nEXEMPLOS PR√ÅTICOS:\nExemplo 1 - Input Fracionado:\nInput: \"15 metros de vergalh√£o F10\"\nProcessamento:\n- Necess√°rio: 15 metros\n- C√°lculo: 15 √∑ 12 = 1,25 barras\n- Arredondamento: ceil(1,25) = 2 barras\n- Resultado: 2 barras √ó 12m = 24 metros totais\nExemplo 2 - Quantidade Exata:\nInput: \"36 metros de var√£o 3/8\"\nProcessamento:\n- Necess√°rio: 36 metros\n- C√°lculo: 36 √∑ 12 = 3 barras exatas\n- Resultado: 3 barras √ó 12m = 36 metros totais\nEXEMPLOS PR√ÅTICOS - VERGALH√ïES:\nExemplo 1 - Input Fracionado:\nInput: \"15 metros de vergalh√£o F10\"\nProcessamento:\n- Necess√°rio: 15 metros\n- C√°lculo: 15 √∑ 12 = 1,25 barras\n- Arredondamento: ceil(1,25) = 2 barras\n- Resultado: 2 barras √ó 12m = 24 metros totais\nExemplo 2 - Quantidade Exata:\nInput: \"36 metros de var√£o 3/8\"\nProcessamento:\n- Necess√°rio: 36 metros\n- C√°lculo: 36 √∑ 12 = 3 barras exatas\n- Resultado: 3 barras √ó 12m = 36 metros totais\nEXEMPLOS PR√ÅTICOS - MALHAS:\nExemplo 1 - √Årea Fracionada:\nInput: \"10m¬≤ de malha 15x15\"\nProcessamento:\n- Necess√°rio: 10m¬≤\n- C√°lculo: 10 √∑ 6 = 1,67 telas\n- Arredondamento: ceil(1,67) = 2 telas\n- Resultado: 2 telas √ó 6m¬≤ = 12m¬≤ totais\nExemplo 2 - √Årea Exata:\nInput: \"18m¬≤ de tela soldada\"\nProcessamento:\n- Necess√°rio: 18m¬≤\n- C√°lculo: 18 √∑ 6 = 3 telas exatas\n- Resultado: 3 telas √ó 6m¬≤ = 18m¬≤ totais\nExemplo 3 - √Årea Pequena:\nInput: \"4m¬≤ de malha de a√ßo\"\nProcessamento:\n- Necess√°rio: 4m¬≤\n- C√°lculo: 4 √∑ 6 = 0,67 telas\n- Arredondamento: ceil(0,67) = 1 tela\n- Resultado: 1 tela √ó 6m¬≤ = 6m¬≤ totais\nFORMATO DE RESPOSTA OBRIGAT√ìRIO:\nPARA VERGALH√ïES:\njson{\n  \"orcamento_formatado\": \"* **2 Vergalh√µes F10 (barras 12m):** R$ 156,00\\n\\n*Obs: Vergalh√µes vendidos apenas em barras de 12m. Quantidade necess√°ria: 15m = 2 barras (24m totais)*\",\n  \"observacoes_tecnicas\": \"Vergalh√µes s√£o vendidos exclusivamente em barras inteiras de 12 metros. Metragem solicitada: Xm | Barras necess√°rias: Y | Metragem total: Zm\"\n}\nPARA MALHAS:\njson{\n  \"orcamento_formatado\": \"* **2 Malhas 15x15 (telas 3x2m):** R$ 240,00\\n\\n*Obs: Malhas vendidas apenas em telas de 3x2m (6m¬≤). √Årea necess√°ria: 10m¬≤ = 2 telas (12m¬≤ totais)*\",\n  \"observacoes_tecnicas\": \"Malhas s√£o vendidas exclusivamente em telas inteiras de 3x2m (6m¬≤). √Årea solicitada: Xm¬≤ | Telas necess√°rias: Y | √Årea total: Zm¬≤\"\n}\nC√ÅLCULO MATEM√ÅTICO:\nFUN√á√ÉO PARA VERGALH√ïES:\njavascriptfunction calcularVergalhao(metrosSolicitados) {\n    const COMPRIMENTO_BARRA = 12;\n    const barrasNecessarias = Math.ceil(metrosSolicitados / COMPRIMENTO_BARRA);\n    const metragemTotal = barrasNecessarias * COMPRIMENTO_BARRA;\n    \n    return {\n        barras: barrasNecessarias,\n        metragemTotal: metragemTotal,\n        sobra: metragemTotal - metrosSolicitados\n    };\n}\nFUN√á√ÉO PARA MALHAS:\njavascriptfunction calcularMalha(areaSolicitada) {\n    const AREA_TELA = 6; // 3m √ó 2m = 6m¬≤\n    const telasNecessarias = Math.ceil(areaSolicitada / AREA_TELA);\n    const areaTotal = telasNecessarias * AREA_TELA;\n    \n    return {\n        telas: telasNecessarias,\n        areaTotal: areaTotal,\n        sobra: areaTotal - areaSolicitada\n    };\n}\nIDENTIFICA√á√ÉO AUTOM√ÅTICA:\n‚úÖ PALAVRAS-CHAVE PARA VERGALH√ïES:\n\n\"vergalh√£o\", \"vergalhao\"\n\"var√£o\", \"varao\"\n\"ferro CA-50\", \"ferro CA-60\"\n\"barra de ferro\"\nCombina√ß√µes com bitolas: \"F8\", \"F10\", \"F12.5\", \"3/8\", \"1/2\", etc.\n\n‚úÖ PALAVRAS-CHAVE PARA MALHAS:\n\n\"malha\", \"malha de a√ßo\"\n\"tela soldada\", \"tela de a√ßo\"\n\"malha eletrossoldada\", \"tela eletrossoldada\"\n\"malha CA-60\", \"tela CA-60\"\nCombina√ß√µes: \"malha 15x15\", \"tela 10x10\", etc.\n\n‚ùå EXCE√á√ïES (N√ÉO SE APLICA A ESTAS REGRAS):\n\n\"ferragem\" (s√£o arma√ß√µes sob medida)\n\"treli√ßa\" (s√£o vendidas por metro)\n\"arame\" (vendido por rolo)\n\"isopor\", \"lajota\" (t√™m suas pr√≥prias dimens√µes)\n\nMENSAGENS EXPLICATIVAS PADR√ÉO:\nPARA VERGALH√ïES:\n\"*Observa√ß√£o: Vergalh√µes/var√µes s√£o comercializados exclusivamente em barras inteiras de 12 metros. \nPara sua necessidade de [X]m, ser√£o fornecidas [Y] barras, totalizando [Z]m.*\"\nPARA MALHAS:\n\"*Observa√ß√£o: Malhas/telas de a√ßo s√£o comercializadas exclusivamente em pe√ßas de 3x2m (6m¬≤). \nPara sua necessidade de [X]m¬≤, ser√£o fornecidas [Y] telas, totalizando [Z]m¬≤.*\"\nINTEGRA√á√ÉO COM FERRAMENTAS:\nMODIFICA√á√ÉO NA BUSCA_PRECO PARA VERGALH√ïES:\nQuando identificar vergalh√£o/var√£o:\n\nCalcular barras necess√°rias com ceil()\nBuscar pre√ßo unit√°rio por barra (n√£o por metro)\nOBRIGAT√ìRIO: Multiplicar barras_necess√°rias √ó pre√ßo_unit√°rio_por_barra\nIncluir observa√ß√£o sobre venda em barras\n\nEXEMPLO CR√çTICO DE C√ÅLCULO:\nInput: \"15m de vergalh√£o F10\"\nProcessamento:\n- Metragem solicitada: 15m\n- Barras necess√°rias: ceil(15 √∑ 12) = ceil(1,25) = 2 barras\n- Pre√ßo unit√°rio por barra: R$ 78,00\n- VALOR TOTAL: 2 √ó R$ 78,00 = R$ 156,00 ‚úÖ\n- NUNCA: R$ 78,00 (pre√ßo de 1 barra apenas) ‚ùå\nMODIFICA√á√ÉO NA BUSCA_PRECO PARA MALHAS:\nQuando identificar malha/tela:\n\nCalcular telas necess√°rias com ceil()\nBuscar pre√ßo unit√°rio por tela (n√£o por m¬≤)\nOBRIGAT√ìRIO: Multiplicar telas_necess√°rias √ó pre√ßo_unit√°rio_por_tela\nIncluir observa√ß√£o sobre venda em telas de 3x2m\n\nEXEMPLO CR√çTICO DE C√ÅLCULO:\nInput: \"15m¬≤ malha de a√ßo\"\nProcessamento:\n- √Årea solicitada: 15m¬≤\n- Telas necess√°rias: ceil(15 √∑ 6) = ceil(2,5) = 3 telas\n- Pre√ßo unit√°rio por tela: R$ 80,00\n- VALOR TOTAL: 3 √ó R$ 80,00 = R$ 240,00 ‚úÖ\n- NUNCA: R$ 80,00 (pre√ßo de 1 tela apenas) ‚ùå\nVALIDA√á√ÉO FINAL:\nCHECKLIST PR√â-OUTPUT (ATUALIZADO):\n[ ] Identificou corretamente como vergalh√£o/var√£o OU malha/tela?\n[ ] Calculou pe√ßas necess√°rias com arredondamento para cima (ceil)?\n[ ] Incluiu quantidade total (pe√ßas √ó dimens√£o padr√£o)?\n[ ] **CR√çTICO**: Multiplicou quantidade_pe√ßas √ó pre√ßo_unit√°rio?\n[ ] Adicionou observa√ß√£o explicativa espec√≠fica?\n[ ] Valor final reflete o total de pe√ßas necess√°rias?\n[ ] Informou sobra quando aplic√°vel?\nALGORITMO DE VALIDA√á√ÉO MATEM√ÅTICA:\njavascript// VALIDA√á√ÉO OBRIGAT√ìRIA ANTES DO OUTPUT\nfunction validarCalculoCompleto(input, pecasNecessarias, precoUnitario, valorFinal) {\n    const valorEsperado = pecasNecessarias * precoUnitario;\n    \n    if (valorFinal !== valorEsperado) {\n        ERRO_CR√çTICO: \"Valor final n√£o corresponde ao c√°lculo correto\";\n        return false;\n    }\n    return true;\n}\nFLUXO DE DECIS√ÉO INTEGRADO:\nINPUT recebido\n    ‚Üì\nCont√©m \"vergalh√£o\", \"var√£o\", \"ferro CA-\"?\n    ‚Üì\n    SIM ‚Üí Aplicar regra de barras 12m\n    ‚Üì\n    N√ÉO ‚Üí Cont√©m \"malha\", \"tela\"?\n        ‚Üì\n        SIM ‚Üí Aplicar regra de telas 3x2m (6m¬≤)\n        ‚Üì\n        N√ÉO ‚Üí Processar normalmente\n\nüéØ POSICIONAMENTO NO PROMPT PRINCIPAL\nINSERIR AP√ìS: Se√ß√£o \"üîí REGRA CR√çTICA DE PRESERVA√á√ÉO DE DADOS INPUT ‚Üí OUTPUT\"\nANTES DE: Se√ß√£o \"üìã FORMATO DE SA√çDA OBRIGAT√ìRIO\"\nEstas regras devem ser aplicadas automaticamente sempre que o sistema detectar solicita√ß√µes de vergalh√µes/var√µes ou malhas/telas, garantindo transpar√™ncia total com o cliente sobre as pol√≠ticas de venda em pe√ßas padronizadas inteiras.\nRESUMO EXECUTIVO:\n\nVERGALH√ïES/VAR√ïES: Barras de 12m (arredondar para cima)\nMALHAS/TELAS: Pe√ßas de 3x2m = 6m¬≤ (arredondar para cima)\nTRANSPAR√äNCIA: Sempre informar quantidade real fornecida\nC√ÅLCULO: Sempre considerar pe√ßas inteiras, nunca fracionadas\n‚ö†Ô∏è CR√çTICO: SEMPRE multiplicar quantidade_pe√ßas √ó pre√ßo_unit√°rio = valor_total_correto\n\nEXEMPLO CORRETO COMPLETO:\nInput: \"15m¬≤ malha de a√ßo\"\n‚úÖ Processamento correto:\n1. √Årea necess√°ria: 15m¬≤\n2. Telas necess√°rias: ceil(15√∑6) = 3 telas\n3. Pre√ßo unit√°rio: R$ 80,00 por tela\n4. Valor total: 3 √ó R$ 80,00 = R$ 240,00\n5. Output: \"3 Malhas de A√ßo (telas 3x2m): R$ 240,00\"\n6. Obs: \"√Årea solicitada: 15m¬≤ = 3 telas (18m¬≤ totais)\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        980,
        20
      ],
      "id": "f08a55e7-dc51-418b-bf92-11227a4ca55b",
      "name": "or√ßamentos",
      "retryOnFail": false,
      "waitBetweenTries": 1500
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ff85f63a-9eea-4eb6-aaa3-e9616c791c00",
              "name": "id.workflowferramentas",
              "value": "4pdizWewQzdsLsGx",
              "type": "string"
            },
            {
              "id": "6a06262d-deb7-4493-bdc0-045c05773560",
              "name": "produtos",
              "value": "={{ $json.produtos }}",
              "type": "object"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        620,
        40
      ],
      "id": "db678a86-5c30-402a-8482-219a2510ac61",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "description": "=Busca o pre√ßo de um produto a partir do nome e especifica√ß√µes t√©cnicas. Use sempre que o cliente quiser saber pre√ßo de um item espec√≠fico. \nIMPORTANTE: \n- Para treli√ßas/ferragens em unidades, calcule PRIMEIRO a metragem total\n- Exemplo: 38 treli√ßas de 2.50m = 38 √ó 2.50 = 95 metros\n- Depois multiplique o pre√ßo por metro pela metragem total",
        "source": "=database",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "=preco_produto",
            "tableName": "produtos_precos",
            "NomeProduto": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('NomeProduto', `Nome do produto que o cliente mencionou. Deve ser uma palavra-chave presente no nome cadastrado, como \"Ferragem F10\", \"Isopor H8\", \"Lajota\", \"Estribo\", etc.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        980,
        340
      ],
      "id": "a0298779-53cb-46f9-9162-5c89ec69da93",
      "name": "busca_preco"
    },
    {
      "parameters": {
        "name": "salvar_orcamento",
        "description": "=Salva um or√ßamento para um cliente com a lista de produtos cotados, pre√ßos, total e v√≠nculo com o lead correspondente.\nPara cada produto:\n- Identifique o nome exato (conforme a tabela de produtos).\n- Use o tool 'busca_produto' para consultar o pre√ßo na tabela 'produtos_precos'.\n- Calcule o subtotal: preco_unitario √ó quantidade.\n",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "salvar_orcamento",
            "tableName": "orcamentos",
            "leadid": "1",
            "Produtos": "={{ JSON.stringify($fromAI('produtos', `Gere a lista de produtos que o cliente deseja or√ßar. Para cada produto:\n- Identifique o nome exato (conforme a tabela de produtos).\n- Use o tool 'busca_produto' para consultar o pre√ßo na tabela 'produtos_precos'.\n- Calcule o subtotal: preco_unitario √ó quantidade.\n- Retorne os campos:\n\n[\n  {\n    \\\"nome\\\": \\\"Ferragem F10\\\",\n    \\\"quantidade\\\": 12,\n    \\\"unidade\\\": \\\"metro\\\",\n    \\\"detalhes\\\": {\n      \\\"bitola_estribo\\\": \\\"4.2mm\\\",\n      \\\"tamanho_estribo\\\": \\\"7x17\\\",\n    \\\"preco_unitario\\\": 25.00,\n    \\\"subtotal\\\": 300.00\n    }\n  },\n  ...\n]\n\nSe n√£o souber alguma especifica√ß√£o, deixe o campo 'detalhes' vazio ou omita.\nNunca estime valores manualmente. Sempre consulte o pre√ßo com 'busca_produto'.`, 'json')) }}",
            "Obs": "={{ $fromAI('observacoes', `Observa√ß√µes gerais sobre o or√ßamento solicitado. Inclua instru√ß√µes extras dadas pelo cliente, coment√°rios adicionais, condi√ß√µes especiais (como forma de pagamento ou prazo), ou qualquer informa√ß√£o que ajude o setor comercial ou log√≠stica. Se o cliente n√£o disser nada relevante, retorne string vazia.`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "id": "192e8725-220c-421d-ab77-eb5d490591fe",
      "name": "salvar_orcamento",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        1080,
        360
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "description": "=Calcula o custo e o pre√ßo estimado de uma ferragem sob medida com base em comprimento, \n  ferros longitudinais (bitola e quantidade), tamanho e bitola dos estribos, espa√ßamento entre estribos,\n  custos de material e m√£o de obra. Caso a bitola dos estribos n√£o seja informada, usa-se \"F4.2\" como padr√£o, e se o espa√ßo entre os estribos n√£o for informada, usa-se \"0.20\", se o a quantidade de ferros n√£o for informada considere como padr√£o 4\nCaso n√£o tenha o comprimento procurar antes de calcular",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "CalcFer",
            "ferragem": "={\n  \"comprimento\": {{ $fromAI(\"comprimento\", \"Comprimento total da ferragem em metros. Ex: para 'Ferragem 5,00', o valor √© 5. \", \"number\") }},\n  \"ferros_longitudinais\": {{ $fromAI(\"ferros_longitudinais\", \"Lista de ferros longitudinais utilizados na ferragem. Cada item deve conter: - bitola (ex: 'F10', 'F12', 'F8', etc) - quantidade de var√µes dessa bitola. Formato: [ { \\\"bitola\\\": \\\"F10\\\", \\\"quantidade\\\": 4 }, { \\\"bitola\\\": \\\"F12\\\", \\\"quantidade\\\": 2 } ] Extraia mesmo que o cliente envie como '4F10+2F12', converta para este array e envie como string JSON. se n√£o a quantidade de ferros n√£o vinhe informado considere que √© 4\", \"string\") }},\n  \"tamanho_estribo\": \"{{ $fromAI(\"tamanho_estribo\", \"Tamanho do estribo no formato 'largura x altura' em cm. Ex: '7x20'.\", \"string\") }}\",\n  \"espacamento_estribo\": \"{{ $fromAI(\"espacamento_estribo\", \"Espa√ßamento entre estribos em metros. Ex: para 'a cd 0,15', o valor √© 0.15. Se n√£o for informado, use o padr√£o '0.20'.\", \"number\") }}\",\n  \"bitola_estribo\": \"{{ $fromAI(\"bitola_estribo\", \"Bitola do ferro do estribo (ex: 'F5'). Se n√£o for informado, use o padr√£o 'F4.2'.\", \"string\") }}\"\n}\n"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1540,
        320
      ],
      "id": "c13462d1-a5ce-4458-8198-3e435229fbe7",
      "name": "calcular_ferragem_personalizada"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Mostra os produtos mais cotados em or√ßamentos recentes dos √∫ltimos 30 dias.",
        "operation": "executeQuery",
        "query": "SELECT\n  produto ->> 'nome' AS produto,\n  COUNT(*) AS total\nFROM\n  orcamentos,\n  jsonb_array_elements(produtos) AS produto\nWHERE\n  data > NOW() - INTERVAL '30 days'\nGROUP BY\n  produto\nORDER BY\n  total DESC\nLIMIT 5;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1180,
        340
      ],
      "id": "0b86182a-b2c1-493f-872a-f01728cc52b7",
      "name": "produtos_mais_cotados",
      "credentials": {
        "postgres": {
          "id": "z2oHR8Hcbud4cXb6",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-1.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        880,
        360
      ],
      "id": "a3e2731a-9262-4e97-8463-67be9e83b25e",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "GOTIgGndJIkf9Pqy",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        1640,
        260
      ],
      "id": "f2dd64d0-4d30-4769-8159-ca0aad82acca",
      "name": "Calculator"
    },
    {
      "parameters": {
        "description": "Calcula materiais para laje quando voc√™ tem as dimens√µes espec√≠ficas (largura x comprimento). Use esta tool quando o cliente informar dimens√µes como '5x8', '6.5x10', '7x12', etc. Ideal para projetos onde voc√™ conhece as medidas exatas da laje.",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "calcLaje",
            "especificacoes": "={\n      \"largura\": \"{{ $fromAI('largura', 'Largura da laje em metros. Ex: para \\\"5x8\\\", extraia \\\"5\\\". Se n√£o informado ou formato √°rea (40m¬≤), deixe vazio.', 'string', '') }}\",\n      \"comprimento\": \"{{ $fromAI('comprimento', 'Comprimento da laje em metros. Ex: para \\\"5x8\\\", extraia \\\"8\\\". Se n√£o informado ou formato √°rea (40m¬≤), deixe vazio.', 'string', '') }}\",\n      \"enchimento\": \"{{ $fromAI('enchimento', 'Tipo de enchimento: \\\"isopor\\\" ou \\\"lajota\\\". Se cliente n√£o especificar, use \\\"isopor\\\".', 'string', 'isopor') }}\",\n      \"malha\": \"{{ $fromAI('malha', 'Tipo de malha: \\\"Leve\\\", \\\"Media\\\" ou \\\"Refor√ßada\\\". Se n√£o especificado, use \\\"Media\\\".', 'string', 'Media') }}\"\n    }"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1300,
        360
      ],
      "id": "ef152a0c-3811-4a0e-afd1-de55b103892d",
      "name": "calcular_laje_dimensoes"
    },
    {
      "parameters": {
        "description": "Calcula materiais para laje quando voc√™ tem apenas a √°rea total. Use esta tool quando o cliente informar √°rea como '40m¬≤', '50 metros quadrados', '60m2', etc. Ideal para projetos onde voc√™ s√≥ conhece a √°rea total da laje.",
        "workflowId": {
          "__rl": true,
          "value": "={{$('Edit Fields').item.json.id.workflowferramentas}}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "operation": "calcLaje",
            "especificacoes": "={\n      \"largura\": \"{{ $fromAI('largura', 'Largura da laje em metros. Ex: para \\\"5x8\\\", extraia \\\"5\\\". Se n√£o informado ou formato √°rea (40m¬≤), deixe vazio.', 'string', '') }}\",\n      \"comprimento\": \"{{ $fromAI('comprimento', 'Comprimento da laje em metros. Ex: para \\\"5x8\\\", extraia \\\"8\\\". Se n√£o informado ou formato √°rea (40m¬≤), deixe vazio.', 'string', '') }}\",\n      \"enchimento\": \"{{ $fromAI('enchimento', 'Tipo de enchimento: \\\"isopor\\\" ou \\\"lajota\\\". Se cliente n√£o especificar, use \\\"isopor\\\".', 'string', 'isopor') }}\",\n      \"malha\": \"{{ $fromAI('malha', 'Tipo de malha: \\\"Leve\\\", \\\"Media\\\" ou \\\"Refor√ßada\\\". Se n√£o especificado, use \\\"Media\\\".', 'string', 'Media') }}\",\n      \"area\": \"{{ $fromAI('area', '√Årea total da laje em metros quadrados. Ex: para \\\"40m¬≤\\\", extraia \\\"40\\\". Use apenas se n√£o houver largura x comprimento.', 'string', '') }}\"\n    }"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "operation",
              "displayName": "operation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "tableName",
              "displayName": "tableName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "especificacoes",
              "displayName": "especificacoes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            },
            {
              "id": "ferragem",
              "displayName": "ferragem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "detalhes",
              "displayName": "detalhes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": true
            },
            {
              "id": "NomeProduto",
              "displayName": "NomeProduto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "leadid",
              "displayName": "leadid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Produtos",
              "displayName": "Produtos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Obs",
              "displayName": "Obs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "Query",
              "displayName": "Query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1400,
        340
      ],
      "id": "100bf75d-ccb3-4d63-b86c-2aeb2e4fc2c6",
      "name": "calcular_laje_area"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        700,
        320
      ],
      "id": "faca2fb1-0d88-4ed0-81c1-6fa81499f617",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "3mNlZ20nDfXfgUl9",
          "name": "OpenAi account"
        }
      }
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "or√ßamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calcular_ferragem_personalizada": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "salvar_orcamento": {
      "ai_tool": [
        []
      ]
    },
    "busca_preco": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "produtos_mais_cotados": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "calcular_laje_dimensoes": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "calcular_laje_area": {
      "ai_tool": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "or√ßamentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "produtos": "  {\n\"lista_produtos\": \"3 Treli√ßas Concretadas 6m, 100 Lajotas Cer√¢mica, 1 Malha 3m x 2m, 1kg Arame Queimado, 1 Ferragem armada 7x15mm F10 (3/8\\\"), 2 Vergalh√£o F8 (5/16\\\") 12m\",\n  \"tipo_projeto\": \"misto\",\n  \"dimensoes_laje\": \"\"\n}"
        }
      }
    ]
  },
  "versionId": "dc8fb2a2-679a-4890-86ad-af9aeb78590e",
  "triggerCount": 0,
  "tags": []
}